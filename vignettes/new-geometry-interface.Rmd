---
title: "New geometry interface"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{New geometry interface}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  eval = TRUE,
  echo = TRUE,
  comment = "#>"
)
```

## Introduction

`spatsoc` (> v 0.2.11) provides a new geometry interface. The motivation is to
allow users to supply a geometry column instead of providing coordinates and
optionally crs through the "coords" and "crs" args. This interface is enabled by
default on all functions that accept coordinates / geometry, by leaving the
coords null and ensuring the geometry column has been set up using
`get_geometry()`. 


### Setup

Load packages

```{r}
library(spatsoc)
library(data.table)
```

Example data and variables

```{r}
# Read example data
DT <- fread(system.file('extdata', 'DT.csv', package = 'spatsoc'))

coords <- c('X', 'Y')
crs <- 32736
datetime <- 'datetime'
id <- 'ID'
```

## `get_geometry`

`get_geometry` can be used to setup a `DT` with a simple feature geometry list
column. Optionally, the input coordinates can be transformed using the argument
"output_crs". The default output geometry column name can be changed using the 
argument "geometry_colname". 

### Usage

```{r}

# Get geometry
get_geometry(DT, coords = coords, crs = crs)

print(DT)
```


### Converting from other packages

Alternatively, coming from other packages, we can convert the objects to 
data.tables for processing with spatsoc. 

#### Converting from {sftrack}

```{r}
library(sftrack)
data("raccoon")
raccoon$timestamp <- as.POSIXct(raccoon$timestamp, "EST")
burstz <- list(id = raccoon$animal_id, month = as.POSIXlt(raccoon$timestamp)$mon)
my_track <- as_sftrack(raccoon,
  group = burstz, time = "timestamp",
  error = NA, coords = c("longitude", "latitude")
)

DT_sftrack <- as.data.table(my_track)
```

#### Converting from {move2}

```{r}
library(move2)
fishers <- mt_read(mt_example(file = "fishers.csv.gz"))
DT_move2 <- as.data.table(fishers)
```

### Converting to packages

After processing with {spatsoc}, optionally convert output to work with other
packages. 

#### Converting to {sf}

```{r}
DT_sf <- st_as_sf(DT, sf_column_name = geometry)
library(sf)
print(DT_sf)
plot(DT_sf)
```


#### Converting to {sftrack}

```{r}
library(sftrack)

# First convert to sf as above, then:
DT_sftrack <- as_sftrack(DT_sf, group = c(id = id), time = datetime)

head(DT_sftrack)
plot(DT_sftrack)
```

#### Converting to {move2}

```{r}
library(move2)

DT_move2 <- mt_as_move2(DT, 
                   time_column = datetime, 
                   track_id_column = id, 
                   sf_column_name = geometry)
print(DT_move2)
plot(DT_move2)
```
